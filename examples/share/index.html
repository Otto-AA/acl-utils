<!doctype html>
<html>
  <head>
    <title>acl-utils | parser example</title>

    <style type="text/css">
      textarea {
        width: 40%;
        min-height: 50em;
      }
    </style>
  </head>
  <body>
    <h1>acl-utils | parser example</h1>
    <p>Here you can test out how the acl file is modified when it is parsed to an AclDoc and then without any modification parsed backwards to acl (acl -> AclDoc -> acl)</p>
    <p>It is mainly for testing out if nothing gets omitted while parsing, but you can also see the base usage of the parser in this example.</p>
    <form>
      <label for="baseUri">Url of the acl file</label>
      <input type="text" id="baseUri" value="./file.acl">

      <label for="accessTo">Url of the file you want to share</label>
      <input type="text" id="accessTo" value="./file">
  
      <label for="shareWith">Share with:</label>
      <input type="text" id="shareWith" value="https://solid.example.org/profile/card#me">
      <br>

      <label for="readPerm">Give READ permissions</label>
      <input type="checkbox" id="readPerm" checked>
      <br>
      <label for="writePerm">Give WRITE permissions</label>
      <input type="checkbox" id="writePerm" checked>
      <br>
      <label for="appendPerm">Give APPEND permissions</label>
      <input type="checkbox" id="appendPerm">
      <br>
      <label for="controlPerm">Give CONTROL permissions</label>
      <input type="checkbox" id="controlPerm">
      <br>

      <button type="button" id="parse">Parse</button>
    </form>
    <textarea id="aclInput" placeholder="Please copy an acl file here"></textarea>
    <textarea id="aclOutput" placeholder="Output will be shown here"></textarea>

    <script type="application/javascript" src="../../dist/browser/acl-utils.bundle.js"></script>
    <script type="application/javascript">
      const { AclParser, AclRule, Permissions, Agents } = AclUtils
      const { READ, WRITE, APPEND, CONTROL} = Permissions
      
      const parseButton = document.getElementById('parse')
      parseButton.onclick = () => {
        console.log('clicked button')
        const baseUri = document.getElementById('baseUri').value
        const originalAcl = document.getElementById('aclInput').value

        const parser = new AclParser(baseUri)

        parser.turtleToAclDoc(originalAcl)
          .then(doc => {
            console.log('doc', doc)

            // NOTE: Following could be done much simpler. This is just for demonstrating every single step
            // Here are three levels of shortcuts you could use:
            // doc.addRule(rule) - You can pass an aclRule (As done in the following example)
            // doc.addRule(permissions, agents) - You can pass a permissions and agents object
            // doc.addRule([READ, WRITE], 'https://web.id.org/#me') - You can pass an array/value of permissions and an array/value of webIds
            const permissions = new Permissions()
            if (document.getElementById('readPerm').checked) {
              permissions.add(READ)
            }
            if (document.getElementById('writePerm').checked) {
              permissions.add(WRITE)
            }
            if (document.getElementById('appendPerm').checked) {
              permissions.add(APPEND)
            }
            if (document.getElementById('controlPerm').checked) {
              permissions.add(CONTROL)
            }

            const agents = new Agents()
            agents.addWebId(document.getElementById('shareWith').value)

            const accessTo = document.getElementById('accessTo').value
            const rule = new AclRule(permissions, agents, accessTo)
            doc.addRule(rule)

            return parser.aclDocToTurtle(doc)
          })
          .then(turtle => {
            console.log('turtle', turtle)
            document.getElementById('aclOutput').innerHTML = turtle
          })
      }
    </script>
  </body>